<div *ngIf="isLoading; else loadedBlock">
    <mat-spinner diameter="300" strokeWidth="5"></mat-spinner>
</div>
<ng-template #loadedBlock>
    <div *ngIf="isInTeam; then inTeamBlock else notInTeamBlock"></div>
    <!-- notInTeamBlock: student is not in a group -->
    <ng-template #notInTeamBlock>

        <div>
            <h2 class="mat-h2 tabtitle">Elenco studenti not in team.</h2>


            <form class="example-form" [formGroup]="form" (submit)="onSubmit()">
                <mat-form-field class="example-full-width">
                    <mat-label>Group name</mat-label>
                    <input matInput formControlName="groupNameControl" (input)="checkValidity()">
                </mat-form-field>


                <mat-form-field class="example-full-width">
                    <mat-label>Timeout of proposal in minutes</mat-label>
                    <input matInput type="number" formControlName="timeoutControl" min=10 (input)="checkValidity()">
                </mat-form-field>

                <button type="submit" mat-raised-button color="primary" (click)="addStudentsToGroup()"
                    [disabled]="isDisabled">Add to group</button>


            </form>



            <ngb-alert *ngIf="isErrorAlertOpen" type='danger' (close)="isErrorAlertOpen=false">Sorry... the group was
                not created try with another name. </ngb-alert>


            <table #table mat-table [dataSource]="dataSourceStudentNotYetInTeam" matSort #matSortNotInTeam = matSort class="mat-elevation-z8">

                <!-- ID Column -->
                <ng-container matColumnDef="id">
                    <th mat-header-cell mat-sort-header *matHeaderCellDef> Id </th>
                    <td mat-cell *matCellDef="let student"> {{student.id}} </td>
                </ng-container>

                <!-- Group Column -->
                <!-- Groups are not modelled yet, providing a default value. -->
                <ng-container matColumnDef="group">
                    <th mat-header-cell mat-sort-header *matHeaderCellDef> Group </th>
                    <td mat-cell *matCellDef="let student"> {{(student.group) || "---"}} </td>
                </ng-container>

                <!-- Name Column -->
                <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
                    <td mat-cell *matCellDef="let student"> {{student.name}} </td>
                </ng-container>

                <!-- First Name Column -->
                <ng-container matColumnDef="first name">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> FirstName </th>
                    <td mat-cell *matCellDef="let student"> {{student.firstName}} </td>
                </ng-container>

                <!-- Checkbox Column -->
                <ng-container matColumnDef="select">
                    <th mat-header-cell *matHeaderCellDef>
                        <mat-checkbox (change)="$event ? masterToggle() : null"
                            [checked]="selection.hasValue() && isAllSelected()"
                            [indeterminate]="selection.hasValue() && !isAllSelected()">
                        </mat-checkbox>
                    </th>
                    <td mat-cell *matCellDef="let row">
                        <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? toggleRow(row) : null"
                            [checked]="selection.isSelected(row)">
                        </mat-checkbox>
                    </td>
                </ng-container>


                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
            <mat-paginator #paginatorNotInTeam [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>

        </div>

        <mat-divider></mat-divider>


        <!-- Requests of proposal for a team-->
        <div>


            <h2 class="mat-h2 tabtitle"> Elenco proposte ricevute</h2>

            <table mat-table [dataSource]="dataSourceProposals" matSort  #matSortProposal = matSort class="mat-elevation-z8">

                <!--- Note that these columns can be defined in any order.
                          The actual rendered columns are set as a property on the row definition" -->

                <!-- idCreator Column -->
                <ng-container matColumnDef="idCreator">
                    <th mat-header-cell *matHeaderCellDef> Creator </th>
                    <td mat-cell *matCellDef="let element"> {{element.idCreator}} </td>
                </ng-container>
                <!-- groupName Column -->
                <ng-container matColumnDef="groupName">
                    <th mat-header-cell *matHeaderCellDef> Group name </th>
                    <td mat-cell *matCellDef="let element"> {{element.groupName}} </td>
                </ng-container>

                <!-- matricola Column -->
                <ng-container matColumnDef="matricola">
                    <th mat-header-cell *matHeaderCellDef> Freshman </th>
                    <td mat-cell *matCellDef="let element"> {{element.matricola}} </td>
                </ng-container>

                <!-- name Column -->
                <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef> Name </th>
                    <td mat-cell *matCellDef="let element"> {{element.name}} </td>
                </ng-container>

                <!-- firstName Column -->
                <ng-container matColumnDef="firstName">
                    <th mat-header-cell *matHeaderCellDef> firstName </th>
                    <td mat-cell *matCellDef="let element"> {{element.firstName}} </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumnsProposals"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumnsProposals;"></tr>
            </table>
            <mat-paginator #paginatorProposal [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
        </div>
    </ng-template>

    <!-- inTeamBlock: student is in a group -->
    <ng-template #inTeamBlock>

        <h2 class="mat-h2 tabtitle">Elenco studenti in team.</h2>

        <table #table mat-table [dataSource]="dataSourceStudentInTeam" matSort #matSortInTeam = matSort class="mat-elevation-z8">

            <!-- Group Column -->
            <!-- Groups are not modelled yet, providing a default value. -->
            <ng-container matColumnDef="group">
                <th mat-header-cell mat-sort-header *matHeaderCellDef> Group </th>
                <td mat-cell *matCellDef="let student"> {{(student.group) || "---"}} </td>
            </ng-container>

            <!-- ID Column -->
            <ng-container matColumnDef="id">
                <th mat-header-cell mat-sort-header *matHeaderCellDef> Id </th>
                <td mat-cell *matCellDef="let student"> {{student.id}} </td>
            </ng-container>

            <!-- Name Column -->
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
                <td mat-cell *matCellDef="let student"> {{student.name}} </td>
            </ng-container>

            <!-- First Name Column -->
            <ng-container matColumnDef="first name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> FirstName </th>
                <td mat-cell *matCellDef="let student"> {{student.firstName}} </td>
            </ng-container>


            <tr mat-header-row *matHeaderRowDef="displayedColumnsInTeam"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumnsInTeam;"></tr>
        </table>
        <mat-paginator #paginatorNotInTeam [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>

    </ng-template>


</ng-template>